<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shaft Configurator</title>
    <style>
        /* Minimal styling for floating header and basic controls */
        #price-header {
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            z-index: 999999;
            padding: 15px 20px;
            border-bottom: 3px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        #price-display {
            font-size: 24px;
            font-weight: bold;
            color: #2B5B7F;
            position: relative;
        }
        
        #leadtime-display {
            font-size: 16px;
            font-weight: 600;
            position: relative;
        }
        
        .price-change-indicator {
            position: absolute;
            top: 100%;
            left: 0;
            font-size: 18px;
            font-weight: bold;
            margin-top: 5px;
            animation: fadeInOut 3s ease-in-out;
            pointer-events: none;
        }
        
        .price-increase {
            color: #27ae60;
        }
        
        .price-decrease {
            color: #e74c3c;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-10px); }
            15% { opacity: 1; transform: translateY(0); }
            85% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(5px); }
        }
        
        .header-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #quantity {
            width: 60px;
            padding: 8px;
            border: 2px solid #333;
            border-radius: 4px;
            font-size: 14px;
        }
        
        #add-to-cart {
            padding: 10px 20px;
            background: #E67E22;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }
        
        #add-to-cart:hover {
            background: #D35400;
        }
        
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        /* Layout container for controls and preview */
        .main-layout {
            display: flex;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .controls-section {
            flex: 0 0 auto;
            width: 375px;
            max-width: 375px;
            min-width: 375px;
            overflow-x: hidden;
            padding: 12px;
            box-sizing: border-box;
        }
        
        .preview-section {
            flex: 1;
            position: sticky;
            top: 100px;
            height: fit-content;
            display: none;
        }
        
        .preview-pane {
            background: #f5f5f5;
            border: 2px solid #333;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        .preview-front {
            min-height: 400px;
        }
        
        .preview-ends {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .preview-end {
            background: #f5f5f5;
            border: 2px solid #333;
            border-radius: 4px;
            padding: 20px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        /* Show preview on larger screens */
        @media (min-width: 1024px) {
            .preview-section {
                display: block;
            }
        }
        
        /* Toggle switch styling */
        .toggle-container {
            display: flex;
            gap: 4px;
            border: 2px solid #333;
            border-radius: 4px;
            overflow: hidden;
            width: 100%;
        }
        
        .toggle-option {
            padding: 8px 16px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }
        
        .toggle-option.active {
            background: #2B5B7F;
            color: white;
        }
        
        .toggle-option:hover:not(.active) {
            background: #f0f0f0;
        }
        
        /* Button styling */
        button {
            padding: 8px 16px;
            border: 2px solid #333;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #f0f0f0;
        }
        
        /* Summary styling */
        summary {
            font-weight: bold;
            font-size: 15px;
            cursor: pointer;
            padding: 10px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            margin-bottom: 8px;
            list-style: none;
            position: relative;
            padding-left: 28px;
        }
        
        summary::-webkit-details-marker {
            display: none;
        }
        
        summary::before {
            content: '▼';
            position: absolute;
            left: 8px;
            transition: transform 0.2s;
        }
        
        details:not([open]) summary::before {
            transform: rotate(-90deg);
        }
        
        summary:hover {
            background: #e8e8e8;
        }
        
        details > div {
            padding: 0;
            margin-bottom: 12px;
        }
        
        h4 {
            margin-top: 12px;
            margin-bottom: 6px;
            color: #2B5B7F;
            font-size: 14px;
        }
        
        .advanced-features {
            border-left: 3px solid #E67E22;
            padding-left: 10px;
            margin-top: 10px;
        }
        
        * {
            box-sizing: border-box;
        }
        
        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            font-size: 14px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        
        label {
            font-size: 14px;
        }
        
        p {
            font-size: 14px;
            margin: 6px 0;
        }
        
        /* Custom number input with orange split buttons */
        input[type="number"] {
            -moz-appearance: textfield;
            appearance: textfield;
        }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .number-input-wrapper {
            display: inline-flex;
            align-items: stretch;
            gap: 0;
            max-width: 130px;
        }
        
        .number-input-wrapper input[type="number"] {
            width: 70px;
            min-width: 0;
            border-radius: 3px 0 0 3px;
            border-right: none;
            text-align: center;
        }
        
        .number-input-buttons {
            display: flex;
            flex-direction: row;
        }
        
        .number-input-buttons button {
            width: 30px;
            border: none;
            background: #E67E22;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .number-input-buttons button:first-child {
            border-right: 1px solid white;
        }
        
        .number-input-buttons button:last-child {
            border-radius: 0 3px 3px 0;
        }
        
        .number-input-buttons button:hover {
            background: #D35400;
        }
        
        .number-input-buttons button:active {
            background: #BA4A00;
        }
        
        /* Corner condition radio cards */
        .corner-cards {
            display: flex;
            gap: 3px;
            flex-wrap: nowrap;
            width: 100%;
        }
        
        .corner-card {
            flex: 1 1 0;
            min-width: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 4px 2px;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }
        
        .corner-card:hover {
            border-color: #2B5B7F;
            background: #f8f9fa;
        }
        
        .corner-card input[type="radio"] {
            display: none;
        }
        
        .corner-card input[type="radio"]:checked + .corner-graphic {
            background: #E8F4F8;
            border-radius: 3px;
        }
        
        .corner-card input[type="radio"]:checked ~ .corner-label {
            color: #2B5B7F;
            font-weight: bold;
        }
        
        .corner-card:has(input[type="radio"]:checked) {
            border-color: #2B5B7F;
            background: #E8F4F8;
        }
        
        .corner-graphic {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2px;
            width: 100%;
        }
        
        .corner-graphic svg {
            width: 32px;
            height: 32px;
            display: block;
        }
        
        .corner-label {
            font-size: 10px;
            text-align: center;
            color: #333;
            line-height: 1.2;
        }
        
        .corner-detail-controls {
            margin-top: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 3px;
            display: none;
        }
        
        .corner-detail-controls label {
            display: block;
            margin-bottom: 4px;
            font-size: 13px;
        }
        
        .corner-detail-controls select {
            width: 100%;
        }
        
        /* iOS-style toggle switches */
        .ios-toggle-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        
        .ios-toggle-label {
            font-size: 14px;
            color: #333;
            flex: 1;
            padding-right: 10px;
        }
        
        .ios-toggle {
            position: relative;
            display: inline-block;
            width: 46px;
            height: 26px;
            flex-shrink: 0;
        }
        
        .ios-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .ios-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 26px;
        }
        
        .ios-toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        .ios-toggle input:checked + .ios-toggle-slider {
            background-color: #E67E22;
        }
        
        .ios-toggle input:checked + .ios-toggle-slider:before {
            transform: translateX(20px);
        }
        
        #initial-journal-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }
        
        #initial-journal-buttons button {
            width: 100%;
        }
        
        hr {
            margin: 10px 0;
            border: none;
            border-top: 1px solid #ddd;
        }
        
        /* ========== MOBILE STYLES ========== */
        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
            }
            
            #price-header {
                flex-wrap: wrap;
                gap: 8px;
                padding: 10px;
            }
            
            #price-display {
                font-size: 18px;
            }
            
            #leadtime-display {
                font-size: 14px;
            }
            
            .main-layout {
                padding: 0;
                margin: 0;
                gap: 0;
            }
            
            .controls-section {
                width: 100%;
                max-width: 100%;
                min-width: 0;
                padding: 8px;
            }
            
            details > div {
                padding: 0;
                margin-bottom: 10px;
            }
            
            summary {
                padding: 8px;
                padding-left: 26px;
                font-size: 14px;
                margin-bottom: 6px;
            }
            
            summary::before {
                left: 6px;
                font-size: 12px;
            }
            
            h4 {
                font-size: 13px;
                margin-top: 8px;
                margin-bottom: 4px;
            }
            
            p {
                font-size: 13px;
                margin: 4px 0;
                word-wrap: break-word;
            }
            
            .corner-cards {
                gap: 2px;
            }
            
            .corner-card {
                padding: 3px 1px;
                border-width: 1px;
            }
            
            .corner-graphic svg {
                width: 26px;
                height: 26px;
            }
            
            .corner-label {
                font-size: 9px;
            }
            
            input[type="number"],
            input[type="text"],
            select {
                font-size: 13px;
                padding: 5px;
            }
            
            .number-input-wrapper {
                max-width: 110px;
            }
            
            .number-input-wrapper input[type="number"] {
                width: 55px;
                font-size: 13px;
            }
            
            .number-input-buttons button {
                width: 27px;
                font-size: 13px;
            }
            
            .toggle-container {
                gap: 2px;
                border-width: 1px;
            }
            
            .toggle-option {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .ios-toggle {
                width: 42px;
                height: 24px;
            }
            
            .ios-toggle-slider:before {
                height: 20px;
                width: 20px;
            }
            
            .ios-toggle input:checked + .ios-toggle-slider:before {
                transform: translateX(18px);
            }
            
            .ios-toggle-row {
                padding: 6px 0;
            }
            
            .corner-detail-controls {
                margin-top: 6px;
                padding: 6px;
            }
            
            .corner-detail-controls label {
                font-size: 12px;
                margin-bottom: 3px;
            }
            
            button {
                padding: 7px 12px;
                font-size: 13px;
                border-width: 1px;
            }
            
            #initial-journal-buttons {
                margin-top: 8px;
                gap: 6px;
            }
            
            .advanced-features {
                padding-left: 8px;
                margin-top: 8px;
            }
            
            hr {
                margin: 8px 0;
            }
            
            strong, em {
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
        }
        
        .controls-section * {
            max-width: 100%;
        }
    </style>
</head>
<body>
    <!-- Floating Price/Lead Time/Quantity Header -->
    <div id="price-header">
        <div id="price-display">$125.00</div>
        <div id="leadtime-display">Ships: Mon, Nov 4 (5 days)</div>
        <div class="header-group">
            <label for="quantity">Qty:</label>
            <input type="number" id="quantity" value="1" min="1" max="1000">
        </div>
        <button id="add-to-cart">Add to Cart</button>
    </div>
    
    <div class="main-layout">
        <div class="controls-section">
    
    <!-- Advanced Mode Toggle -->
    <div class="ios-toggle-row" style="padding: 10px 0;">
        <span class="ios-toggle-label">Advanced</span>
        <label class="ios-toggle">
            <input type="checkbox" id="advanced-mode-toggle">
            <span class="ios-toggle-slider"></span>
        </label>
    </div>
    
    <hr>
    
    <!-- General Details -->
    <details open>
        <summary>GENERAL DETAILS</summary>
        <div>
            <div class="ios-toggle-row">
                <span class="ios-toggle-label">Turned, Ground & Polished</span>
                <label class="ios-toggle">
                    <input type="checkbox" id="finish-tgp-toggle">
                    <span class="ios-toggle-slider"></span>
                </label>
            </div>
            
            <h4>Material</h4>
            <select id="material-select">
                <option value="1018">1018 Cold Rolled Steel</option>
                <option value="1045">1045 Medium Carbon Steel</option>
                <option value="4140">4140 Alloy Steel</option>
                <option value="303">303 Stainless Steel</option>
                <option value="304">304 Stainless Steel</option>
                <option value="316">316 Stainless Steel</option>
            </select>
            
            <h4>Tolerance</h4>
            <p><em>Standard: ±0.005"</em></p>
            
            <h4>Global Corner Conditions</h4>
            <p><strong>Inside Corners:</strong></p>
            <div class="corner-cards">
                <label class="corner-card">
                    <input type="radio" name="global-inside" value="sharp" checked>
                    <div class="corner-graphic">
                        <svg width="60" height="60" viewBox="0 0 60 60">
                            <line x1="37.5" y1="15" x2="37.5" y2="37.5" stroke="#1E3A5F" stroke-width="15" stroke-linecap="square"/>
                            <line x1="37.5" y1="37.5" x2="15" y2="37.5" stroke="#1E3A5F" stroke-width="15" stroke-linecap="square"/>
                            <circle cx="30" cy="30" r="2.5" fill="#E67E22"/>
                        </svg>
                    </div>
                    <div class="corner-label">Sharp</div>
                </label>
                
                <label class="corner-card">
                    <input type="radio" name="global-inside" value="chamfer">
                    <div class="corner-graphic">
                        <svg width="60" height="60" viewBox="0 0 60 60">
                            <line x1="37.5" y1="15" x2="37.5" y2="37.5" stroke="#1E3A5F" stroke-width="15" stroke-linecap="square"/>
                            <line x1="37.5" y1="37.5" x2="15" y2="37.5" stroke="#1E3A5F" stroke-width="15" stroke-linecap="square"/>
                            <polygon points="30,15 30,30 15,30" fill="#1E3A5F"/>
                            <line x1="30" y1="15" x2="15" y2="30" stroke="#E67E22" stroke-width="3"/>
                        </svg>
                    </div>
                    <div class="corner-label">Chamfer</div>
                </label>
                
                <label class="corner-card">
                    <input type="radio" name="global-inside" value="radius">
                    <div class="corner-graphic">
                        <svg width="60" height="60" viewBox="0 0 60 60">
                            <line x1="37.5" y1="15" x2="37.5" y2="37.5" stroke="#1E3A5F" stroke-width="15" stroke-linecap="square"/>
                            <line x1="37.5" y1="37.5" x2="15" y2="37.5" stroke="#1E3A5F" stroke-width="15" stroke-linecap="square"/>
                            <path d="M 30 15 L 30 30 L 15 30 Q 30 30, 30 15 Z" fill="#1E3A5F"/>
                            <path d="M 30 15 Q 30 30, 15 30" fill="none" stroke="#E67E22" stroke-width="3"/>
                        </svg>
                    </div>
                    <div class="corner-label">Radius</div>
                </label>
            </div>
            
            <div id="global-inside-chamfer-controls" class="corner-detail-controls">
                <label>Chamfer Distance: 
                    <select>
                        <option value="0.015">0.015"</option>
                        <option value="0.030" selected>0.030"</option>
                        <option value="0.045">0.045"</option>
                        <option value="0.060">0.060"</option>
                    </select>
                </label>
            </div>
            
            <div id="global-inside-radius-controls" class="corner-detail-controls">
                <label>Radius: 
                    <select>
                        <option value="0.015">0.015"</option>
                        <option value="0.030">0.030"</option>
                        <option value="0.045">0.045"</option>
                        <option value="0.060" selected>0.060"</option>
                    </select>
                </label>
            </div>
            
            <p><strong>Outside Corners:</strong></p>
            <div class="corner-cards">
                <label class="corner-card">
                    <input type="radio" name="global-outside" value="sharp" checked>
                    <div class="corner-graphic">
                        <svg width="60" height="60" viewBox="0 0 60 60">
                            <line x1="22.5" y1="45" x2="22.5" y2="22.5" stroke="#1E3A5F" stroke-width="15" stroke-linecap="square"/>
                            <line x1="22.5" y1="22.5" x2="45" y2="22.5" stroke="#1E3A5F" stroke-width="15" stroke-linecap="square"/>
                            <circle cx="15" cy="15" r="2.5" fill="#E67E22"/>
                        </svg>
                    </div>
                    <div class="corner-label">Sharp</div>
                </label>
                
                <label class="corner-card">
                    <input type="radio" name="global-outside" value="chamfer">
                    <div class="corner-graphic">
                        <svg width="60" height="60" viewBox="0 0 60 60">
                            <line x1="22.5" y1="45" x2="22.5" y2="22.5" stroke="#1E3A5F" stroke-width="15" stroke-linecap="square"/>
                            <line x1="22.5" y1="22.5" x2="45" y2="22.5" stroke="#1E3A5F" stroke-width="15" stroke-linecap="square"/>
                            <polygon points="15,15 15,30 30,15" fill="#E67E22"/>
                            <line x1="15" y1="30" x2="30" y2="15" stroke="#E67E22" stroke-width="3"/>
                        </svg>
                    </div>
                    <div class="corner-label">Chamfer</div>
                </label>
                
                <label class="corner-card">
                    <input type="radio" name="global-outside" value="radius">
                    <div class="corner-graphic">
                        <svg width="60" height="60" viewBox="0 0 60 60">
                            <line x1="22.5" y1="45" x2="22.5" y2="22.5" stroke="#1E3A5F" stroke-width="15" stroke-linecap="square"/>
                            <line x1="22.5" y1="22.5" x2="45" y2="22.5" stroke="#1E3A5F" stroke-width="15" stroke-linecap="square"/>
                            <path d="M 15 15 L 15 37.5 Q 15 15, 37.5 15 Z" fill="#E67E22"/>
                            <path d="M 15.25 37.5 Q 15.25 15.25, 37.5 15.25" fill="none" stroke="#E67E22" stroke-width="0.5"/>
                        </svg>
                    </div>
                    <div class="corner-label">Radius</div>
                </label>
            </div>
            
            <div id="global-outside-chamfer-controls" class="corner-detail-controls">
                <label>Chamfer Distance: 
                    <select>
                        <option value="0.015">0.015"</option>
                        <option value="0.030" selected>0.030"</option>
                        <option value="0.045">0.045"</option>
                        <option value="0.060">0.060"</option>
                    </select>
                </label>
            </div>
            
            <div id="global-outside-radius-controls" class="corner-detail-controls">
                <label>Radius: 
                    <select>
                        <option value="0.015">0.015"</option>
                        <option value="0.030">0.030"</option>
                        <option value="0.045">0.045"</option>
                        <option value="0.060" selected>0.060"</option>
                    </select>
                </label>
            </div>
            
            <p><em>Note: Defaults apply to all steps. Override per-step in Advanced mode.</em></p>
        </div>
    </details>
    
    <!-- Main Shaft -->
    <details open>
        <summary>MAIN SHAFT</summary>
        <div>
            <h4>Dimensions</h4>
            <p>Diameter:</p>
            <select id="main-diameter">
                <option value="0.5">1/2"</option>
                <option value="0.75">3/4"</option>
                <option value="1.0" selected>1"</option>
                <option value="1.25">1-1/4"</option>
                <option value="1.5">1-1/2"</option>
                <option value="2.0">2"</option>
            </select>
            
            <p style="margin-top: 8px;">Length (inches):</p>
            <input type="number" id="main-length" value="6" min="1" max="24" step="0.5">
            
            <div class="ios-toggle-row" style="margin-top: 8px;">
                <span class="ios-toggle-label">Left Keyway</span>
                <label class="ios-toggle">
                    <input type="checkbox" id="main-left-keyway-toggle">
                    <span class="ios-toggle-slider"></span>
                </label>
            </div>
            
            <div class="ios-toggle-row">
                <span class="ios-toggle-label">Right Keyway</span>
                <label class="ios-toggle">
                    <input type="checkbox" id="main-right-keyway-toggle">
                    <span class="ios-toggle-slider"></span>
                </label>
            </div>
        </div>
    </details>
    
    <!-- Add Journal Buttons -->
    <div id="initial-journal-buttons">
        <button type="button" class="add-journal-left">+ Add Journal LEFT</button>
        <button type="button" class="add-journal-right">+ Add Journal RIGHT</button>
    </div>
    
    <div id="journals-container"></div>
    
        </div>
        
        <!-- Preview Section -->
        <div class="preview-section">
            <div class="preview-pane preview-front">
                <div>Front View Preview</div>
            </div>
            <div class="preview-ends">
                <div class="preview-end">
                    <div>Left End View</div>
                </div>
                <div class="preview-end">
                    <div>Right End View</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===========================================
        // GLOBAL STATE
        // ===========================================
        let journalCounter = 0;
        const journals = {
            left: [],
            right: []
        };

        // ===========================================
        // TG&P MATERIAL RESTRICTIONS
        // ===========================================
        const tgpToggle = document.getElementById('finish-tgp-toggle');
        const materialSelect = document.getElementById('material-select');
        
        // Store original selected value
        let previousMaterial = materialSelect.value;
        
        function updateMaterialOptions() {
            const isTGP = tgpToggle.checked;
            const stainlessOptions = ['303', '304', '316'];
            
            // Get all options
            Array.from(materialSelect.options).forEach(option => {
                if (stainlessOptions.includes(option.value)) {
                    if (isTGP) {
                        // Disable stainless options when TG&P is on
                        option.disabled = true;
                        option.style.color = '#999';
                        option.textContent = option.textContent.replace(' (Not available with TG&P)', '') + ' (Not available with TG&P)';
                    } else {
                        // Enable when TG&P is off
                        option.disabled = false;
                        option.style.color = '';
                        option.textContent = option.textContent.replace(' (Not available with TG&P)', '');
                    }
                }
            });
            
            // If current selection is stainless and TG&P just turned on, switch to 1018
            if (isTGP && stainlessOptions.includes(materialSelect.value)) {
                materialSelect.value = '1018';
                alert('TG&P finish is not available for stainless steel. Material changed to 1018 Cold Rolled Steel.');
            }
        }
        
        // Initialize material restrictions on load
        updateMaterialOptions();
        
        // Update when TG&P toggle changes
        tgpToggle.addEventListener('change', function() {
            updateMaterialOptions();
            updateHeight();
        });

        // ===========================================
        // JOURNAL CREATION FUNCTIONS
        // ===========================================
        function createJournal(side) {
            journalCounter++;
            const journalId = `journal-${side}-${journalCounter}`;
            
            const journalHTML = `
                <details open>
                    <summary>JOURNAL ${side.toUpperCase()} #${journals[side].length + 1}</summary>
                    <div>
                        <h4>Dimensions</h4>
                        <p>Diameter:</p>
                        <select id="${journalId}-diameter">
                            <option value="0.375">3/8"</option>
                            <option value="0.5">1/2"</option>
                            <option value="0.625">5/8"</option>
                            <option value="0.75" selected>3/4"</option>
                            <option value="0.875">7/8"</option>
                            <option value="1.0">1"</option>
                        </select>
                        
                        <p style="margin-top: 8px;">Length (inches):</p>
                        <input type="number" id="${journalId}-length" value="1" min="0.25" max="12" step="0.25">
                        
                        <h4 style="margin-top: 12px;">Features</h4>
                        
                        <div class="ios-toggle-row">
                            <span class="ios-toggle-label">Keyway</span>
                            <label class="ios-toggle">
                                <input type="checkbox" id="${journalId}-keyway">
                                <span class="ios-toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="ios-toggle-row">
                            <span class="ios-toggle-label">Thread</span>
                            <label class="ios-toggle">
                                <input type="checkbox" id="${journalId}-thread">
                                <span class="ios-toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div id="${journalId}-thread-controls" class="advanced-features" style="display: none;">
                            <p><strong>Thread Type:</strong></p>
                            <select id="${journalId}-thread-type">
                                <option value="unc">UNC (Coarse)</option>
                                <option value="unf">UNF (Fine)</option>
                            </select>
                            <p style="margin-top: 8px;"><strong>Thread Size:</strong></p>
                            <select id="${journalId}-thread-size">
                                <option value="1/4-20">1/4-20</option>
                                <option value="5/16-18">5/16-18</option>
                                <option value="3/8-16">3/8-16</option>
                                <option value="1/2-13">1/2-13</option>
                                <option value="5/8-11">5/8-11</option>
                            </select>
                        </div>
                        
                        <button type="button" class="remove-journal" data-journal-id="${journalId}" data-side="${side}" style="margin-top: 12px; width: 100%; background: #e74c3c; color: white; border-color: #c0392b;">
                            Remove Journal
                        </button>
                    </div>
                </details>
            `;
            
            // Add to journals array
            journals[side].push({
                id: journalId,
                element: journalHTML
            });
            
            // Insert into DOM
            const container = document.getElementById('journals-container');
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = journalHTML;
            container.appendChild(tempDiv.firstElementChild);
            
            // Setup thread toggle handler
            const threadToggle = document.getElementById(`${journalId}-thread`);
            const threadControls = document.getElementById(`${journalId}-thread-controls`);
            
            threadToggle.addEventListener('change', function() {
                threadControls.style.display = this.checked ? 'block' : 'none';
                updateHeight();
            });
            
            // Setup remove button handler
            const removeBtn = document.querySelector(`[data-journal-id="${journalId}"]`);
            removeBtn.addEventListener('click', function() {
                removeJournal(journalId, side);
            });
            
            // Show/hide initial journal buttons
            updateInitialButtons();
            
            // Update height
            updateHeight();
            
            console.log(`Created journal: ${journalId}`);
        }
        
        function removeJournal(journalId, side) {
            // Find and remove from array
            const index = journals[side].findIndex(j => j.id === journalId);
            if (index > -1) {
                journals[side].splice(index, 1);
            }
            
            // Remove from DOM
            const detailsElement = document.querySelector(`[data-journal-id="${journalId}"]`).closest('details');
            detailsElement.remove();
            
            // Renumber remaining journals
            renumberJournals(side);
            
            // Show/hide initial journal buttons
            updateInitialButtons();
            
            // Update height
            updateHeight();
            
            console.log(`Removed journal: ${journalId}`);
        }
        
        function renumberJournals(side) {
            const journalElements = document.querySelectorAll(`details summary`);
            let counter = 1;
            
            journalElements.forEach(summary => {
                const text = summary.textContent;
                if (text.includes(`JOURNAL ${side.toUpperCase()}`)) {
                    summary.textContent = `JOURNAL ${side.toUpperCase()} #${counter}`;
                    counter++;
                }
            });
        }
        
        function updateInitialButtons() {
            const initialButtons = document.getElementById('initial-journal-buttons');
            const hasAnyJournals = journals.left.length > 0 || journals.right.length > 0;
            
            // Hide initial buttons if any journals exist, show if none exist
            initialButtons.style.display = hasAnyJournals ? 'none' : 'flex';
        }

        // ===========================================
        // BUTTON CLICK HANDLERS
        // ===========================================
        document.querySelectorAll('.add-journal-left').forEach(btn => {
            btn.addEventListener('click', function() {
                createJournal('left');
            });
        });
        
        document.querySelectorAll('.add-journal-right').forEach(btn => {
            btn.addEventListener('click', function() {
                createJournal('right');
            });
        });

        // ===========================================
        // CORNER CONDITION HANDLERS
        // ===========================================
        document.querySelectorAll('input[name="global-inside"]').forEach(radio => {
            radio.addEventListener('change', function() {
                document.getElementById('global-inside-chamfer-controls').style.display = 'none';
                document.getElementById('global-inside-radius-controls').style.display = 'none';
                
                if (this.value === 'chamfer') {
                    document.getElementById('global-inside-chamfer-controls').style.display = 'block';
                } else if (this.value === 'radius') {
                    document.getElementById('global-inside-radius-controls').style.display = 'block';
                }
                updateHeight();
            });
        });
        
        document.querySelectorAll('input[name="global-outside"]').forEach(radio => {
            radio.addEventListener('change', function() {
                document.getElementById('global-outside-chamfer-controls').style.display = 'none';
                document.getElementById('global-outside-radius-controls').style.display = 'none';
                
                if (this.value === 'chamfer') {
                    document.getElementById('global-outside-chamfer-controls').style.display = 'block';
                } else if (this.value === 'radius') {
                    document.getElementById('global-outside-radius-controls').style.display = 'block';
                }
                updateHeight();
            });
        });

        // ===========================================
        // HEIGHT UPDATE SYSTEM
        // ===========================================
        function updateHeight() {
            const height = document.documentElement.scrollHeight;
            window.parent.postMessage({type: 'resize', height: height}, '*');
        }

        // Update height on various events
        window.addEventListener('load', updateHeight);
        window.addEventListener('resize', updateHeight);
        
        // Watch for DOM changes
        const observer = new MutationObserver(updateHeight);
        observer.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true
        });
        
        // Update height when details elements open/close
        document.querySelectorAll('details').forEach(details => {
            details.addEventListener('toggle', updateHeight);
        });
        
        console.log('Shaft Configurator loaded - Standalone version for iframe');
        console.log('Features: TG&P material restrictions, dynamic journal creation');
    </script>
</body>
</html>
